stages:
  - deploy

deploy-job:
  image: node:16  # Node.js 16 버전 사용
  cache:
    paths:
      - node_modules/
  only:
    - pushes
    - main  # main 브랜치에 푸시될 때만 실행
  stage: deploy
  script:
    - npm i -g @cloudtype/cli  # Cloudtype CLI 설치
    - ctype login -t $API_KEY_TOKEN  # API 키로 로그인
    - ctype use test:main  # 프로젝트 사용 설정
    - |
      cat <<EOF >> ./.cloudtype/app.yaml
      name: vue-login
      app: web
      options:
        nodeversion: "16"
        build: npm run build
        spa: true
        buildenv: []
        rewrites: []
      context:
        git:
          url: git@gitlab.com:$CI_PROJECT_NAMESPACE/$CI_PROJECT_NAME.git
          branch: main
        preset: vue
      EOF
    - cat ./.cloudtype/app.yaml  # 생성된 설정 파일 확인
    - ctype apply -f ./.cloudtype/app.yaml  # Cloudtype에 배포